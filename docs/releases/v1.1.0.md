## Woo's NWN Log Parser v1.1.0

A tool for analyzing Neverwinter Nights combat logs with DPS calculations and detailed combat statistics.

### Download

**One File approach** (simple single file, more false-positive AV flags): Download `WoosNwnParser.exe` below and run it.

**One Directory approach** (directory with many files, less false-positive AV flags): Download `WoosNwnParser.zip` below, extract everything to a directory, and run `WoosNwnParser.exe`.

**Windows Security Notice**: Windows may show a SmartScreen warning because this is a new application. Click "More info" → "Run anyway" to proceed. This is normal for new, unsigned applications.

### Security Scan

**One File approach**: VirusTotal: [1/71 vendors flagged](https://www.virustotal.com/gui/file/7f90e4b2df0482ef017ce547ed5ef0f5dde801a7a98d6be068a905f7546faaef)

**One Directory approach**: VirusTotal: [1/71 vendors flagged](https://www.virustotal.com/gui/file/f6688fb62dee2ee0a4dc414bdc1d809df00b35f03b1ebd9c71be7110600643e6)

These are false positives common with unsigned Python executables. The detections are generic ML-based flags, not specific malware signatures. Source code is available for inspection.

### Features

- Real-time combat log parsing
- DPS calculations with time tracking modes
- Damage type breakdown
- Target filtering
- Hit rate statistics
- AB, AC, Saves per target
- Damage immunities per target

### System Requirements

- Windows 10/11
- No installation required - just run the exe

### Changelog

#### Added
- **Column Sorting** - All treeviews now support sortable columns via header clicks
  - Click any column header to sort ascending/descending
  - Visual indicators (↑ ascending, ↓ descending) show current sort state
  - Intelligent type detection (numeric vs string) for optimal sorting
  - Sort preferences persist during data updates
  - Handles formatted numbers (percentages, commas, decimals)
  - New `SortedTreeview` widget component (`app/ui/widgets/sorted_treeview.py`)

#### Changed
- **Target Stats Panel** - Unknown AB and AC values now display as "-" instead of "?" for consistency
- **Attack Bonus Tracking** - Now tracks the most common AB value (mode) instead of maximum to better represent typical attack bonus
  - Filters out temporary buffs/debuffs that previously skewed the max AB value
  - Example: Enemy with mostly +71 AB and occasional +77 buff now correctly shows +71
  - In case of tie frequency, prefers the higher bonus value
- **Performance Optimizations** - Implemented 9 major optimizations across all application layers:
  - **Parser**: Pre-compiled regex patterns (6-31% faster)
  - **Storage**: O(1) caches for targets and damage dealers (95-99% faster lookups)
  - **Storage**: O(1) indices for attacks/events by attacker/target
  - **Storage**: Single-pass counting for attack stats (10-40% faster)
  - **Monitor**: Optional debug_mode flag (saves 42k+ queue operations per 21k lines)
  - **Models**: Added `__slots__` to dataclasses (20-30% memory reduction)
  - **Queue Processor**: Batched UI callbacks (O(n) → O(1) per poll cycle)
  - **DPS Panel**: Incremental tree refresh (30-50% faster UI updates)
- **UI Panels** - All panels now use `SortedTreeview` instead of `ttk.Treeview`
  - DPS Panel with hierarchical parent/child structure
  - Target Stats Panel for target statistics
  - Immunity Panel for damage type immunities
- **Sort Persistence** - Optimized to only re-sort when necessary
  - Skips sorting if user hasn't interacted with sort headers
  - Applies sort only after structural changes (new items added/removed)
  - Reduces unnecessary O(n log n) operations during rapid updates

#### Fixed
- **Timestamp Parsing** - Fixed incorrect elapsed time calculation when gameplay crosses midnight
  - Previously, timestamps only parsed the time portion (HH:MM:SS) and applied it to today's date
  - Now uses efficient manual parsing to extract the full date (month and day) from log timestamps
- **AC Estimation** - Natural 20 hits are now properly excluded from AC estimation (like natural-1 misses)
  - Previously, a natural 20 hit could incorrectly lower the estimated minimum AC
  - This reduces the occurrence of "~" (approximation) symbol in AC estimates
- **AC Estimation** - Hits against flat-footed targets are now automatically discarded
  - Tracks all hit totals (AB+d20 roll) instead of just the minimum
  - When a miss total exceeds recorded hits, those hits are discarded as invalid
  - This correctly handles temporary AC debuffs (flat-footed, blinded, etc.)
  - Example: If target was flat-footed (hit at 35), then recovered (miss at 42), the hit at 35 is discarded
  - Further reduces "~" approximation occurrences and shows true AC estimates
- **AC Estimation** - Attacks miss due to concealment are now excluded from AC estimation
  - Attacks that miss due to concealment (displacement, improved invisibility, etc.) don't reveal AC information
  - These misses had incorrect high totals that would have hit if not for concealment
  - Excluding them provides much more accurate AC estimates
  - Added 5 comprehensive tests to prevent regression
- `Reset Data` button now reverts the "Filter Target" dropdown to "All" after resetting
